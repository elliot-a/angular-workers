angular.module("FredrikSandell.worker-pool",[]).service("WorkerService",["$q",function(a){function b(){j="",i.forEach(function(a,b){0!==b&&(j+=","),j+="'"+a+"'"})}function c(){var a=["","//try {","var window = self;","self.history = {};","var document = {","      readyState: 'complete',","      cookie: '',","      querySelector: function () {},","      createElement: function () {","          return {","              pathname: '',","              setAttribute: function () {}","          };","      }","};","importScripts(<IMPORT_SCRIPTS>);","<CUSTOM_DEP_INCLUDES>","angular = window.angular;","var workerApp = angular.module('WorkerApp', [<DEP_MODULES>]);","workerApp.run(['$q'<STRING_DEP_NAMES>, function ($q<DEP_NAMES>) {","  self.addEventListener('message', function(e) {","    var input = e.data;","    var output = $q.defer();","    var promise = output.promise;","    promise.then(function(success) {","      self.postMessage({event:'success', data : success});","    }, function(reason) {","      self.postMessage({event:'failure', data : reason});","    }, function(update) {","      self.postMessage({event:'update', data : update});","    });","    <WORKER_FUNCTION>;","  });","  self.postMessage({event:'initDone'});","}]);","angular.bootstrap(null, ['WorkerApp']);","//} catch(e) {self.postMessage(JSON.stringify(e));}"];return a.join("\n")}function d(a){var b="";return angular.forEach(a,function(a){k[a]&&(b+="importScripts('"+k[a].url+"');")}),b}function e(a){var b=[];return angular.forEach(a,function(a){k[a]&&b.push("'"+k[a].moduleName+"'")}),b.join(",")}function f(a){var b=a.filter(function(a){return"input"!==a&&"output"!==a&&"$q"!==a}),c={dependencies:b,moduleList:e(b),angularDepsAsStrings:b.length>0?","+b.map(function(a){return"'"+a+"'"}).join(","):"",angularDepsAsParamList:b.length>0?","+b.join(","):"",servicesIncludeStatements:d(b)};return c.workerFuncParamList="input,output"+c.angularDepsAsParamList,c}function g(a,b){return l.replace("<IMPORT_SCRIPTS>",j).replace("<CUSTOM_DEP_INCLUDES>",b.servicesIncludeStatements).replace("<DEP_MODULES>",b.moduleList).replace("<STRING_DEP_NAMES>",b.angularDepsAsStrings).replace("<DEP_NAMES>",b.angularDepsAsParamList).replace("<WORKER_FUNCTION>",a.toString())}var h={},i=[],j="",k={};h.setAngularUrl=function(a){i.push(a),b()},h.addImportScript=function(a){i.push(a),b()};var l=c();h.addDependency=function(a,b,c){return k[a]={url:c,moduleName:b},h};var m=function(b){var c={};return c.worker=b,c.run=function(c){var d=a.defer();return b.addEventListener("message",function(a){var b=a.data.event;if("initDone"===b)throw"Received worker initialization in run method. This should already have occurred!";"success"===b?d.resolve(a.data.data):"failure"===b?d.reject(a.data.data):"update"===b?d.notify(a.data.data):d.reject(a)}),b.postMessage(c),d.promise},c.terminate=function(){b.terminate()},c},n=function(a){return a.slice(0,a.length-1)},o=function(a,b){return"("+a.toString()+")("+b+")"};return h.createAngularWorker=function(b){if(!Array.isArray(b)||b.length<3||"function"!=typeof b[b.length-1])throw"Input needs to be: ['workerInput','deferredOutput'/*optional additional dependencies*/,\n    function(workerInput, deferredOutput /*optional additional dependencies*/)\n        {/*worker body*/}]";var c=a.defer(),d=f(n(b)),e=(window.webkitURL?webkitURL:URL).createObjectURL(new Blob([g(o(b[b.length-1],d.workerFuncParamList),d)],{type:"application/javascript"})),h=new Worker(e);return h.addEventListener("message",function(a){var b=a.data.event;console.log(a.data),"initDone"===b?c.resolve(m(h)):c.reject(a)}),c.promise},h}]);